/*! e50-editor 2015-01-20 */
angular.module("E50Editor",[]),angular.module("E50Editor").directive("e50Bind",["$timeout","$document","taSelection",function(a,b,c){return{require:"ngModel",link:function(d,e,f,g){var h=e.attr("contenteditable");g.$render=function(){e.html(g.$viewValue)},h&&(e.bind("keyup",function(){g.$setViewValue(e.html()),d.$apply()}),e.bind("mouseup",function(){d.$apply()})),e.bind("focus",function(){e.addClass("focused"),a(function(){d.focused=!0,d.edit=!0})}),e.bind("dragover",function(a){a.preventDefault(),a.stopPropagation(),e.addClass("drag-over")}),e.bind("dragleave",function(a){a.preventDefault(),a.stopPropagation(),e.removeClass("drag-over")});var i=function(a){a.preventDefault(),a.stopPropagation();var f=angular.element(a.target);f.hasClass("placeholder")&&(c.setSelectionToElementStart(a.target),f.remove());var h=a.originalEvent.dataTransfer;return angular.forEach(h.files,function(a){var c=new FileReader;c.onload=function(a){b[0].execCommand("insertImage",!1,a.target.result),e.removeClass("drag-over"),g.$setViewValue(e.html()),d.$apply()},c.readAsDataURL(a)}),!1};e.bind("drop",i),d.$on("$destroy",function(){e.unbind("drop",i)})}}}]),angular.module("E50Editor").directive("e50Editor",["E50EditorButtons","E50DefaultToolbar","E50EditorIcons",function(a,b,c){return{restrict:"EA",replace:!0,templateUrl:"/src/views/e50-editor.tpl.html",scope:{html:"=ngModel",tools:"=?e50Tools"},link:function(d){function e(a){var b=$(a.target).closest(".live-editor");b.length||"BUTTON"===a.target.tagName||"I"===a.target.tagName||(d.focused=!1,d.edit=!1,b.removeClass("focused"),d.$apply())}d.focused=!1,d.toolbars=d.tools||b,angular.element(document).bind("mousedown",e),d.$on("$destroy",function(){angular.element(document).unbind("mousedown",e)}),d.name=function(b){var d=c(b);return d?d:a[b].name},d.isActive=function(b){return a[b].isActive()&&!d.isDisabled()},d.execute=function(b){return a[b].execute()},d.isDisabled=function(){return!d.focused}}}}]),angular.module("E50Editor").factory("E50DefaultToolbar",function(){return[["h1","h2","h3","h4","h5","h6","p","pre","blockquote"],["insertOrderedList","insertUnorderedList"],["bold","italic","underline","justifyLeft","justifyCenter","justifyRight"]]}),angular.module("E50Editor").factory("E50EditorButtons",["E50ExecCommand","taBrowserTag","taSelection",function(a,b,c){function d(a){this.name=a,this.isActive=function(){return document.queryCommandValue("formatBlock").toLowerCase()===a},this.execute=function(){i("formatBlock",!1,"<"+b(a)+">")}}function e(a){this.name=a,this.isActive=function(){return document.queryCommandState(a)},this.execute=function(){i(a)}}function f(){this.name="image",this.isActive=function(){var a=c.getSelectionElement();return"IMG"===a.tagName},this.execute=function(){var a=window.prompt("Image url","http://");$document[0].execCommand("insertImage",!1,a)}}function g(a,b){this.name=a,this.execute=function(){i("insertHTML",!1,b)},this.isActive=angular.noop}function h(){this.execute=function(){var a=window.prompt("Link?","http://");i("createLink",!1,a)},this.isActive=function(){var a=c.getSelectionElement();return $(a).closest("a").length}}var i=a;return{h1:new d("h1"),h2:new d("h2"),h3:new d("h3"),h4:new d("h4"),h5:new d("h5"),h6:new d("h6"),p:new d("p"),pre:new d("pre"),blockquote:new d("blockquote"),bold:new e("bold"),italic:new e("italic"),underline:new e("underline"),justifyLeft:new e("justifyLeft"),justifyCenter:new e("justifyCenter"),justifyRight:new e("justifyRight"),link:new h,image:new f,placeholder:new g("placeholder",'<img src="placeholder.png" class="placeholder" alt="Placeholder"/>'),insertOrderedList:new e("insertOrderedList"),insertUnorderedList:new e("insertUnorderedList")}}]),angular.module("E50Editor").factory("E50EditorIcons",function(){function a(a){return'<i class="fa '+a+'" unselectable="on">'}var b={blockquote:"fa-quote-right",bold:"fa-bold",italic:"fa-italic",underline:"fa-underline",justifyLeft:"fa-align-left",justifyCenter:"fa-align-center",justifyRight:"fa-align-right",insertOrderedList:"fa-list-ol",insertUnorderedList:"fa-list-ul",placeholder:"fa-image"};return function(c){return b[c]?a(b[c]):!1}}),angular.module("E50Editor").factory("E50ExecCommand",["taExecCommand",function(a){return a("p")}]),angular.module("e50Editor.tpls",["views/e50-editor.tpl.html"]),angular.module("views/e50-editor.tpl.html",[]).run(["$templateCache",function(a){a.put("views/e50-editor.tpl.html",'<div class="e50-editor">\n  \n  <a href="" ng-click="edit=!edit" class="toggle">\n    <i class="fa fa-edit"></i>\n  </a>\n  \n  <div class="format-buttons" ng-show="edit">\n    <div ng-repeat="group in toolbars">\n      <button type="button" unselectable="on" ng-repeat="button in group" ng-bind-html="name(button)" ng-click="execute(button)" ng-disabled="isDisabled()" tabindex="-1" ng-class="{active:isActive(button)}"></button>\n    </div>\n  </div>\n\n  <div class="live-editor" contenteditable="true" e50-bind ng-model="html"></div>\n\n</div>')}]);